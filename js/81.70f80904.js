"use strict";(self["webpackChunktoutiao_webapp"]=self["webpackChunktoutiao_webapp"]||[]).push([[81],{6081:function(t,e,o){o.r(e),o.d(e,{default:function(){return X}});var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-container"},[e("van-nav-bar",{staticClass:"page-nav-bar",attrs:{fixed:"","left-arrow":"",title:"黑马头条"},on:{"click-left":function(e){return t.$router.back()}}}),e("div",{staticClass:"main-wrap"},[t.loading?e("div",{staticClass:"loading-wrap"},[e("van-loading",{attrs:{color:"#3296fa",vertical:""}},[t._v("加载中")])],1):t.article.title?e("div",{staticClass:"article-detail"},[e("h1",{staticClass:"article-title"},[t._v(t._s(t.article.title))]),e("van-cell",{staticClass:"article-author",scopedSlots:t._u([{key:"icon",fn:function(){return[e("van-image",{staticClass:"avatar",attrs:{round:"",fit:"cover",src:"https://img.yzcdn.cn/vant/cat.jpeg"}})]},proxy:!0},{key:"title",fn:function(){return[e("div",{staticClass:"author-name"},[t._v(t._s(t.article.aut_name))])]},proxy:!0},{key:"label",fn:function(){return[e("div",{staticClass:"publish-date"},[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))])]},proxy:!0},{key:"right-icon",fn:function(){return[e("FollowUser",{attrs:{isFollowed:t.article.is_followed,authorId:t.article.aut_id},on:{"update:isFollowed":function(e){return t.$set(t.article,"is_followed",e)},"update:is-followed":function(e){return t.$set(t.article,"is_followed",e)}}})]},proxy:!0}])}),e("div",{ref:"article-content",staticClass:"article-content markdown-body",domProps:{innerHTML:t._s(t.article.content)}}),e("van-divider",[t._v("正文结束")]),e("CommentList",{ref:"comment-list",staticClass:"comment-list",attrs:{targetId:t.articleId,totalCount:t.totalCommentCount},on:{"update:totalCount":function(e){t.totalCommentCount=e},"update:total-count":function(e){t.totalCommentCount=e},scroll:t.onScroll,"reply-click":t.onReplyClick}})],1):404===t.error?e("div",{staticClass:"error-wrap"},[e("van-icon",{attrs:{name:"failure"}}),e("p",{staticClass:"text"},[t._v("该资源不存在或已删除！")])],1):e("div",{staticClass:"error-wrap"},[e("van-icon",{attrs:{name:"failure"}}),e("p",{staticClass:"text"},[t._v("内容加载失败！")]),e("van-button",{staticClass:"retry-btn",on:{click:t.loadArtcileInfo}},[t._v("点击重试")])],1)]),e("div",{staticClass:"article-comment"},[e("van-button",{staticClass:"comment-btn",attrs:{type:"default",round:"",size:"small"},on:{click:function(e){t.isPostShow=!0}}},[t._v("写评论")]),e("van-icon",{attrs:{color:"#777",name:"comment-o",badge:t.totalCommentCount},on:{click:t.jump}}),e("ArticleCollected",{attrs:{articleId:t.article.art_id},model:{value:t.article.is_collected,callback:function(e){t.$set(t.article,"is_collected",e)},expression:"article.is_collected"}}),e("ArticleLike",{attrs:{attitude:t.article.attitude,articleId:t.article.art_id},on:{"update:attitude":function(e){return t.$set(t.article,"attitude",e)}}}),e("van-icon",{attrs:{color:"#777",name:"share"}})],1),e("van-popup",{attrs:{position:"bottom"},model:{value:t.isPostShow,callback:function(e){t.isPostShow=e},expression:"isPostShow"}},[e("CommentPost",{attrs:{targetId:t.article.art_id},on:{postSuccess:t.onPostSuccess}})],1),e("van-popup",{staticStyle:{height:"100%"},attrs:{position:"bottom"},model:{value:t.isReplyShow,callback:function(e){t.isReplyShow=e},expression:"isReplyShow"}},[t.isReplyShow?e("CommentReply",{attrs:{comment:t.currComment},on:{close:function(e){t.isReplyShow=!1}}}):t._e()],1)],1)},s=[],a=o(2745),i=o(6471),l=function(){var t=this,e=t._self._c;return e("div",[t.isFollowed?e("van-button",{staticClass:"follow-btn",attrs:{round:"",size:"small",loading:t.followLoading},on:{click:t.onFollow}},[t._v(" 已关注 ")]):e("van-button",{staticClass:"follow-btn",attrs:{type:"info",color:"#3296fa",round:"",size:"small",icon:"plus",loading:t.followLoading},on:{click:t.onFollow}},[t._v("关注")])],1)},r=[],c={name:"FollowUser",props:{isFollowed:{type:Boolean,default:!0},authorId:{type:String,default:""}},data(){return{followLoading:!1}},methods:{async onFollow(){this.followLoading=!0;try{this.isFollowed?await(0,a.YE)(this.authorId):await(0,a.u5)(this.authorId),this.$emit("update:isFollowed",!this.isFollowed)}catch(t){t.response&&401===t.response.status?this.$toast(t.response.data.message):this.$toast("操作失败,请重试")}this.followLoading=!1}}},u=c,m=o(1001),d=(0,m.Z)(u,l,r,!1,null,null,null),h=d.exports,p=function(){var t=this,e=t._self._c;return e("van-button",{class:{collected:t.value},attrs:{icon:t.value?"star":"star-o",loading:t.loading},on:{click:t.onCollected}})},f=[],v={name:"ArticleCollected",props:{value:{type:Boolean,default:!0},articleId:{type:String,default:""}},data(){return{loading:!1}},methods:{async onCollected(){this.loading=!0;try{this.value?await(0,a.u1)(this.articleId):await(0,a.$c)(this.articleId),this.$emit("input",!this.value),this.$toast.success(this.value?"取消收藏":"收藏成功")}catch(t){t.response&&401===t.response.status?this.$toast(t.response.data.message):this.$toast("操作失败,请重试")}setTimeout((()=>{this.loading=!1}),1e3)}}},_=v,g=(0,m.Z)(_,p,f,!1,null,"396ec682",null),C=g.exports,y=function(){var t=this,e=t._self._c;return e("van-button",{class:{liked:1===t.attitude},attrs:{icon:1===t.attitude?"good-job":"good-job-o",loading:t.loading},on:{click:t.onLiked}})},w=[],k={name:"ArticleLike",props:{attitude:{type:Number,default:-1},articleId:{type:String,default:""}},data(){return{loading:!1}},methods:{async onLiked(){this.loading=!0;try{let t=-1;1===this.attitude?await(0,a.nD)(this.articleId):(await(0,a.IF)(this.articleId),t=1),this.$emit("update:attitude",t),this.$toast.success(1===t?"点赞成功":"取消点赞")}catch(t){t.response&&401===t.response.status?this.$toast(t.response.data.message):this.$toast("操作失败,请重试")}this.loading=!1}}},b=k,S=(0,m.Z)(b,y,w,!1,null,"7ac31380",null),I=S.exports,$=function(){var t=this,e=t._self._c;return e("div",{staticClass:"comment-list"},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"加载失败，请点击重试","immediate-check":!1},on:{load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(o,n){return e("CommentItem",{key:n,attrs:{comment:o},on:{"reply-click":function(e){return t.$emit("reply-click",e)}}})})),1)],1)},x=[],L=function(){var t=this,e=t._self._c;return e("van-cell",{staticClass:"comment-item",scopedSlots:t._u([{key:"icon",fn:function(){return[e("van-image",{staticClass:"avatar",attrs:{round:"",fit:"cover",src:t.comment.aut_photo}})]},proxy:!0},{key:"title",fn:function(){return[e("div",{staticClass:"author-name"},[t._v(t._s(t.comment.aut_name))])]},proxy:!0},{key:"label",fn:function(){return[e("p",{staticClass:"comment-txt"},[t._v(t._s(t.comment.content))]),e("div",{staticClass:"comment-info-btn"},[e("div",{staticClass:"publish-date"},[t._v(t._s(t._f("relativeTime")(t.comment.pubdate)))]),e("van-button",{staticClass:"reply-btn",attrs:{round:""},on:{click:function(e){return t.$emit("reply-click",t.comment)}}},[t._v("回复"+t._s(t.comment.reply_count)+" ")])],1)]},proxy:!0},{key:"right-icon",fn:function(){return[e("van-button",{staticClass:"like-btn",class:{like:t.comment.is_likeing},attrs:{icon:t.comment.is_likeing?"good-job":"good-job-o",loading:t.commentLoading},on:{click:t.onCommentLike}},[t._v(" "+t._s(t.comment.like_count||"赞")+" ")])]},proxy:!0}])})},P=[],Z={name:"CommentItem",props:{comment:{type:Object,default:()=>({})}},data(){return{commentClone:this.comment,commentLoading:!1}},created(){console.log(this.comment)},methods:{async onCommentLike(){this.commentLoading=!0;try{this.comment.is_liking?(await(0,a.IY)(this.comment.com_id),this.commentClone.like_count>0&&this.commentClone.like_count--):(await(0,a._7)(this.comment.com_id),this.commentClone.like_count++),this.commentClone.is_liking=!this.comment.is_liking}catch(t){this.$toast("操作失败，请重试")}setTimeout((()=>{this.commentLoading=!1}),1e3)}}},T=Z,E=(0,m.Z)(T,L,P,!1,null,"af370f8a",null),A=E.exports,F={name:"CommentList",components:{CommentItem:A},props:{articleId:{type:String,default:""},targetId:{type:String,default:""},totalCount:{type:Number,default:0},commentList:{type:Array,default:()=>[]},type:{type:String,default:"a"}},data(){return{list:[],loading:!1,finished:!1,error:!1,offset:null}},created(){this.loading=!0,this.onLoad()},methods:{async onLoad(){try{const{data:t}=await(0,a.nr)({type:this.type,source:this.targetId,offset:this.offset,limit:10});this.list.push(...t.data.results),this.$emit("update:totalCount",t.data.total_count),this.loading=!1,t.data.results.length?this.offset=t.data.last_id:this.finished=!0}catch(t){this.error=!0,this.loading=!1}},unshiftComment(t){console.log("unshiftComment:",t),this.list.unshift(t)},onReplyClick(t){this.$emit("reply-click",t)}}},R=F,j=(0,m.Z)(R,$,x,!1,null,"97cf7e58",null),D=j.exports,G=function(){var t=this,e=t._self._c;return e("div",{staticClass:"post-comment"},[e("van-field",{staticClass:"post-field",attrs:{rows:"2",autosize:"",type:"textarea",maxlength:"50",placeholder:"评论内容","show-word-limit":""},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}}),e("van-button",{staticClass:"post-btn",attrs:{size:"small",disabled:!t.message.length},on:{click:t.onAddComment}},[t._v("发布")])],1)},z=[],O={name:"CommentPost",props:{articleId:{type:String,default:""},targetId:{type:String,default:""}},data(){return{message:""}},methods:{async onAddComment(){try{const t=this.message.trim();if(!t)return;const{data:e}=await(0,a.AD)({target:this.targetId,content:t,art_id:this.articleId||null});this.$toast.success("评论成功"),this.$emit("postSuccess",e.data.new_obj),this.message=""}catch(t){this.$toast.fail("评论失败")}}}},H=O,Y=(0,m.Z)(H,G,z,!1,null,"0d49416e",null),N=Y.exports,U=function(){var t=this,e=t._self._c;return e("div",[e("van-nav-bar",{attrs:{title:t.comment.reply_count>0?`${t.comment.reply_count}条回复`:"暂无回复","left-arrow":"",fixed:""},scopedSlots:t._u([{key:"left",fn:function(){return[e("van-icon",{attrs:{name:"cross"},on:{click:function(e){return t.$emit("close")}}})]},proxy:!0}])}),e("div",{staticClass:"scroll-wrap"},[e("CommentItem",{attrs:{comment:t.comment}}),e("van-cell",[t._v("全部回复")]),e("CommentList",{ref:"comment-list",attrs:{targetId:t.comment.com_id,type:"c"}})],1),e("div",{staticClass:"reply-bottom"},[e("van-button",{staticClass:"write-btn",attrs:{size:"small",round:""},on:{click:function(e){t.isPostShow=!0}}},[t._v("写评论")])],1),e("van-popup",{attrs:{position:"bottom"},model:{value:t.isPostShow,callback:function(e){t.isPostShow=e},expression:"isPostShow"}},[e("CommentPost",{attrs:{targetId:t.comment.com_id,articleId:t.$route.params.articleId},on:{postSuccess:t.onPostSuccess}})],1)],1)},q=[],B={name:"CommentReply",components:{CommentItem:A,CommentList:D,CommentPost:N},props:{comment:{type:Object,default:()=>({})}},data(){return{list:[],commentClone:this.comment,isPostShow:!1}},methods:{onPostSuccess(t){console.log("回复列表-onPostSuccess:",t),this.commentClone.reply_count++,this.isPostShow=!1,this.$refs["comment-list"].unshiftComment(t)}}},M=B,W=(0,m.Z)(M,U,q,!1,null,"e26d80fa",null),Q=W.exports,V={name:"ArticleIndex",components:{FollowUser:h,ArticleCollected:C,ArticleLike:I,CommentList:D,CommentPost:N,CommentReply:Q},props:{articleId:{type:[Number,String],default:null}},data(){return{loading:!0,article:{},error:0,totalCommentCount:0,isPostShow:!1,commentList:[],isReplyShow:!1,currComment:{}}},created(){this.loadArtcileInfo()},methods:{async loadArtcileInfo(){this.loading=!0;try{const{data:t}=await(0,a.rk)(this.articleId);this.article=t.data,setTimeout((()=>{this.previewImage()}),0)}catch(t){t.response&&404===t.response.status?(this.error=404,this.$toast(t.response.data.message)):this.$toast("获取失败")}this.loading=!1},previewImage(){const t=this.$refs["article-content"],e=t.querySelectorAll("img"),o=[...e].map((t=>t.src));e.forEach(((t,e)=>{t.onclick=()=>{(0,i.Z)({images:o,startPosition:e,closeable:!0})}}))},postSuccess(t){console.log(t),this.isPostShow=!1,this.commentList.unshift(t.new_obj)},onPostSuccess(t){this.isPostShow=!1,this.$refs["comment-list"].unshiftComment(t)},onReplyClick(t){this.currComment=t,this.isReplyShow=!0},jump(){this.$toast("122")},onScroll(){}}},J=V,K=(0,m.Z)(J,n,s,!1,null,"1ad7c486",null),X=K.exports},2745:function(t,e,o){o.d(e,{$c:function(){return D},AD:function(){return U},_7:function(){return Y},u5:function(){return R},IF:function(){return z},gO:function(){return T},u1:function(){return G},IY:function(){return N},YE:function(){return j},nD:function(){return O},p0:function(){return E},QM:function(){return Z},rk:function(){return P},VW:function(){return L},nr:function(){return H},Sx:function(){return F},hz:function(){return A},lS:function(){return x},Zf:function(){return $},TY:function(){return q},HW:function(){return M},r0:function(){return B}});o(2223);var n=o(4471);const s=()=>(0,n.Z)({method:"GET",url:"/v1_0/user"}),a=t=>(0,n.Z)({method:"GET",url:"/v1_0/user/profile"}),i=t=>(0,n.Z)({method:"PATCH",url:"/v1_0/user/profile",data:t}),l=t=>(0,n.Z)({method:"PATCH",url:"/v1_0/user/photo",data:t}),r=t=>(0,n.Z)({method:"GET",url:"/v1_0/articles",params:t}),c=t=>(0,n.Z)({method:"GET",url:`/v1_0/articles/${t}`}),u=t=>(0,n.Z)({method:"POST",url:"/v1_0/user/followings",data:{target:t}}),m=t=>(0,n.Z)({method:"DELETE",url:`/v1_0/user/followings/${t}`}),d=t=>(0,n.Z)({method:"POST",url:"/v1_0/article/collections",data:{target:t}}),h=t=>(0,n.Z)({method:"DELETE",url:`/v1_0/article/collections/${t}`}),p=t=>(0,n.Z)({method:"POST",url:"/v1_0/article/likings",data:{target:t}}),f=t=>(0,n.Z)({method:"DELETE",url:`/v1_0/article/likings/${t}`}),v=()=>(0,n.Z)({method:"GET",url:"/v1_0/user/channels"}),_=t=>(0,n.Z)({method:"GET",url:"/v1_0/channels",params:t}),g=t=>(0,n.Z)({method:"PATCH",url:"/v1_0/user/channels",data:{channels:[t]}}),C=t=>(0,n.Z)({method:"DELETE",url:`/v1_0/user/channels/${t}`}),y=t=>(0,n.Z)({method:"GET",url:"/v1_0/suggestion",params:{q:t}}),w=t=>(0,n.Z)({method:"GET",url:"/v1_0/search",params:t}),k=t=>(0,n.Z)({method:"GET",url:"/v1_0/comments",params:t}),b=t=>(0,n.Z)({method:"POST",url:"/v1_0/comment/likings",data:{target:t}}),S=t=>(0,n.Z)({method:"DELETE",url:`/v1_0/comment/likings/${t}`}),I=t=>(0,n.Z)({method:"POST",url:"/v1_0/comments",data:t}),$=s,x=v,L=r,P=c,Z=_,T=g,E=C,A=y,F=w,R=u,j=m,D=d,G=h,z=p,O=f,H=k,Y=b,N=S,U=I,q=a,B=i,M=l}}]);
//# sourceMappingURL=81.70f80904.js.map