"use strict";(self["webpackChunktoutiao_webapp"]=self["webpackChunktoutiao_webapp"]||[]).push([[769],{2769:function(t,e,n){n.r(e),n.d(e,{default:function(){return $}});var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home-container"},[e("van-nav-bar",{staticClass:"page-nav-bar",attrs:{title:"首页",fixed:""},scopedSlots:t._u([{key:"title",fn:function(){return[e("van-button",{staticClass:"search-btn",attrs:{type:"info",round:"",size:"small",icon:"search",to:"/search"}},[t._v("搜索")])]},proxy:!0}])}),e("van-tabs",{staticClass:"channle-tabs",attrs:{animated:"",swipeable:"","swipe-threshold":"5"},scopedSlots:t._u([{key:"nav-right",fn:function(){return[e("div",{staticClass:"placeholder"}),e("div",{staticClass:"hamburger-btn",on:{click:function(e){t.isChennelEditShow=!0}}},[e("i",{staticClass:"iconfont icon-gengduo"})])]},proxy:!0}]),model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},t._l(t.channels,(function(t){return e("van-tab",{key:t.id,attrs:{title:t.name}},[e("ArticleList",{attrs:{channel:t}})],1)})),1),e("van-popup",{staticClass:"edit-channel-popup",style:{height:"90%"},attrs:{position:"bottom",closeable:""},model:{value:t.isChennelEditShow,callback:function(e){t.isChennelEditShow=e},expression:"isChennelEditShow"}},[e("ChannelEdit",{attrs:{myChannels:t.channels,allChannels:t.allChannels,active:t.active},on:{upActive:t.onActive}})],1)],1)},s=[],i=n(3822),r=n(7247),l=n(2745),o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-list"},[e("van-pull-refresh",{attrs:{"success-text":t.refreshingText,"success-duration":1500},on:{refresh:t.onRefresh},model:{value:t.refreshing,callback:function(e){t.refreshing=e},expression:"refreshing"}},[e("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",error:t.error,"error-text":"请求失败，点击重新加载"},on:{"update:error":function(e){t.error=e},load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t,n){return e("ArticleItem",{key:n,attrs:{article:t}})})),1)],1)],1)},c=[],h=function(){var t=this,e=t._self._c;return e("div",{staticClass:"article-item"},[e("van-cell",{attrs:{to:`/article/${t.article.art_id}`},scopedSlots:t._u([{key:"title",fn:function(){return[e("div",{staticClass:"article-title van-multi-ellipsis--l2"},[t._v(t._s(t.article.title))])]},proxy:!0},{key:"label",fn:function(){return[3===t.article.cover.type?e("div",{staticClass:"cover-wrap"},t._l(t.article.cover.images,(function(t,n){return e("div",{key:n,staticClass:"cover-item"},[e("van-image",{staticClass:"right-image",attrs:{fit:"cover",src:t}})],1)})),0):t._e(),e("div",{staticClass:"label-info-wrap"},[e("span",[t._v(t._s(t.article.aut_name))]),e("span",[t._v(t._s(t.article.comm_count)+" 评论")]),e("span",[t._v(t._s(t._f("relativeTime")(t.article.pubdate)))])])]},proxy:!0},1===t.article.cover.type?{key:"default",fn:function(){return[e("van-image",{staticClass:"right-image",attrs:{fit:"cover",src:t.article.cover.images[0]}})]},proxy:!0}:null],null,!0)})],1)},u=[],d={name:"ArticleItem",props:{article:{type:Object,default:()=>{}}},data(){return{}}},m=d,f=n(1001),v=(0,f.Z)(m,h,u,!1,null,"2a686800",null),p=v.exports,C={name:"ArticleList",components:{ArticleItem:p},props:{channel:{type:Object,default:()=>({})}},data(){return{list:[],loading:!1,finished:!1,timestamp:null,error:!1,refreshing:!1,refreshingText:"刷新成功"}},methods:{async onLoad(){try{const{data:t}=await(0,l.VW)({channel_id:this.channel.id,timestamp:this.timestamp||Date.now()});this.list.push(...t.data.results),this.loading=!1,t.data.results.length?this.timestamp=t.data.pre_timestamp:this.finished=!0}catch(t){this.loading=!1,this.error=!0,this.$toast("接口请求失败，稍后重试")}},async onRefresh(){try{const{data:t}=await(0,l.VW)({channel_id:this.channel.id,timestamp:Date.now()});this.list.unshift(...t.data.results),this.refreshing=!1,this.refreshingText=`刷新成功,更新了${t.data.results.length}条记录`}catch(t){this.refreshingText="刷新失败，请稍后重试",this.refreshing=!1}}}},_=C,g=(0,f.Z)(_,o,c,!1,null,"b90b25b4",null),y=g.exports,E=function(){var t=this,e=t._self._c;return e("div",{staticClass:"channel-edit"},[e("van-cell",{attrs:{title:"我的频道"},scopedSlots:t._u([{key:"default",fn:function(){return[e("van-button",{staticClass:"edit-btn",attrs:{size:"mini",round:"",plain:"",type:"danger"},on:{click:function(e){t.isShowEdit=!t.isShowEdit}}},[t._v(" "+t._s(t.isShowEdit?"完成":"编辑")+" ")])]},proxy:!0}])}),e("van-grid",{staticClass:"my-grid",attrs:{gutter:10}},t._l(t.myChannels,(function(n,a){return e("van-grid-item",{key:n.id,staticClass:"channel-item",class:{active:t.active===a},attrs:{text:n.name},on:{click:function(e){return t.onChannel(n,a)}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("van-icon",{directives:[{name:"show",rawName:"v-show",value:t.isShowEdit&&0!==a,expression:"isShowEdit && index !== 0"}],attrs:{name:"close"}})]},proxy:!0}],null,!0)})})),1),e("van-cell",{attrs:{title:"推荐频道"}}),e("van-grid",{staticClass:"recommend-grid",attrs:{gutter:10}},t._l(t.othAllChannels_lodash,(function(n){return e("van-grid-item",{key:n.id,staticClass:"channel-item",attrs:{text:n.name,icon:"plus"},on:{click:function(e){return t.onAddChannel(n)}}})})),1)],1)},w=[],T={name:"ChannelEdit",props:{myChannels:{type:Array,default:()=>[]},allChannels:{type:Array,default:()=>[]},active:{type:Number,default:0}},data(){return{isShowEdit:!1,channelList:[],myChannelsCopy:this.myChannels}},computed:{...(0,i.rn)(["user"]),othAllChannels(){const t=this.allChannels.filter((t=>!this.myChannels.find((e=>e.id===t.id))));return console.log(t),t},othAllChannels_lodash(){return this.$_.differenceBy(this.allChannels,this.myChannels,"id")}},created(){this.getAllChannels()},methods:{async getAllChannels(){try{const{data:t}=await(0,l.QM)();this.channelList=t.data.channels}catch(t){console.log(t)}},async onAddChannel(t){this.myChannelsCopy.push(t),this.user?(await(0,l.gO)({id:t.id,seq:this.myChannels.length-1}),this.$toast("添加成功")):(0,r.LS)("TOUTIAO_CHANNELS",this.myChannels)},onChannel(t,e){this.isShowEdit?(this.myChannelsCopy.splice(e,1),e<=this.active&&this.$emit("upActive",this.active-1,!0),this.deleteChannel(t)):this.$emit("upActive",e)},async deleteChannel(t){try{this.user?await(0,l.p0)(t.id):(0,r.LS)("channles",this.myChannels)}catch(e){console.log(e),this.$toast("删除频道失败，请稍后重试")}}}},b=T,A=(0,f.Z)(b,E,w,!1,null,"24d01e68",null),S=A.exports,k={data(){return{active:0,channels:[],allChannels:[],isChennelEditShow:!1}},components:{ArticleList:y,ChannelEdit:S},created(){this.loadChannels(),this.loadAllChannels()},computed:{...(0,i.rn)(["user"])},methods:{async loadChannels(){try{let t=[];const e=(0,r.rV)("TOUTIAO_CHANNELS");if(this.user||!e){const{data:e}=await(0,l.lS)();t=e.data.channels}else t=e;this.channels=t}catch(t){this.$toast("获取频道列表数据失败")}},async loadAllChannels(){try{const{data:t}=await(0,l.QM)();this.allChannels=t.data.channels}catch(t){this.$toast("获取所有频道列表失败")}},onActive(t,e=!1){this.active=t,this.isChennelEditShow=e}}},x=k,Z=(0,f.Z)(x,a,s,!1,null,"2e72ec2a",null),$=Z.exports},2745:function(t,e,n){n.d(e,{$c:function(){return H},AD:function(){return Y},_7:function(){return M},u5:function(){return P},IF:function(){return V},gO:function(){return L},u1:function(){return N},IY:function(){return Q},YE:function(){return I},nD:function(){return W},p0:function(){return O},QM:function(){return $},rk:function(){return Z},VW:function(){return x},nr:function(){return z},Sx:function(){return G},hz:function(){return D},lS:function(){return k},Zf:function(){return S},TY:function(){return j},HW:function(){return R},r0:function(){return q}});n(2223);var a=n(4471);const s=()=>(0,a.Z)({method:"GET",url:"/v1_0/user"}),i=t=>(0,a.Z)({method:"GET",url:"/v1_0/user/profile"}),r=t=>(0,a.Z)({method:"PATCH",url:"/v1_0/user/profile",data:t}),l=t=>(0,a.Z)({method:"PATCH",url:"/v1_0/user/photo",data:t}),o=t=>(0,a.Z)({method:"GET",url:"/v1_0/articles",params:t}),c=t=>(0,a.Z)({method:"GET",url:`/v1_0/articles/${t}`}),h=t=>(0,a.Z)({method:"POST",url:"/v1_0/user/followings",data:{target:t}}),u=t=>(0,a.Z)({method:"DELETE",url:`/v1_0/user/followings/${t}`}),d=t=>(0,a.Z)({method:"POST",url:"/v1_0/article/collections",data:{target:t}}),m=t=>(0,a.Z)({method:"DELETE",url:`/v1_0/article/collections/${t}`}),f=t=>(0,a.Z)({method:"POST",url:"/v1_0/article/likings",data:{target:t}}),v=t=>(0,a.Z)({method:"DELETE",url:`/v1_0/article/likings/${t}`}),p=()=>(0,a.Z)({method:"GET",url:"/v1_0/user/channels"}),C=t=>(0,a.Z)({method:"GET",url:"/v1_0/channels",params:t}),_=t=>(0,a.Z)({method:"PATCH",url:"/v1_0/user/channels",data:{channels:[t]}}),g=t=>(0,a.Z)({method:"DELETE",url:`/v1_0/user/channels/${t}`}),y=t=>(0,a.Z)({method:"GET",url:"/v1_0/suggestion",params:{q:t}}),E=t=>(0,a.Z)({method:"GET",url:"/v1_0/search",params:t}),w=t=>(0,a.Z)({method:"GET",url:"/v1_0/comments",params:t}),T=t=>(0,a.Z)({method:"POST",url:"/v1_0/comment/likings",data:{target:t}}),b=t=>(0,a.Z)({method:"DELETE",url:`/v1_0/comment/likings/${t}`}),A=t=>(0,a.Z)({method:"POST",url:"/v1_0/comments",data:t}),S=s,k=p,x=o,Z=c,$=C,L=_,O=g,D=y,G=E,P=h,I=u,H=d,N=m,V=f,W=v,z=w,M=T,Q=b,Y=A,j=i,q=r,R=l}}]);
//# sourceMappingURL=769.bbf8f643.js.map