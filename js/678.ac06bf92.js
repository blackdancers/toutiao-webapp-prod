"use strict";(self["webpackChunktoutiao_webapp"]=self["webpackChunktoutiao_webapp"]||[]).push([[678],{678:function(t,e,s){s.r(e),s.d(e,{default:function(){return u}});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-container"},[e("van-nav-bar",{staticClass:"page-nav-bar",attrs:{title:"登录"},scopedSlots:t._u([{key:"right",fn:function(){return[e("van-icon",{attrs:{name:"cross"},on:{click:function(e){return t.$router.back()}}})]},proxy:!0}])}),e("van-form",{ref:"loginForm",on:{submit:t.onSubmit}},[e("van-field",{attrs:{name:"mobile",label:"手机号",placeholder:"手机号",autocomplete:"off",rules:t.userFormRules.mobile},model:{value:t.user.mobile,callback:function(e){t.$set(t.user,"mobile",e)},expression:"user.mobile"}},[e("i",{staticClass:"iconfont icon-shouji",attrs:{slot:"left-icon"},slot:"left-icon"})]),e("van-field",{attrs:{name:"code",label:"验证码",placeholder:"验证码",autocomplete:"off",rules:t.userFormRules.code},scopedSlots:t._u([{key:"left-icon",fn:function(){return[e("i",{staticClass:"iconfont icon-yanzhengma"})]},proxy:!0},{key:"button",fn:function(){return[t.isCountDown?e("van-count-down",{attrs:{time:t.time,format:"ss秒"},on:{finish:function(e){t.isCountDown=!1}}}):e("van-button",{staticClass:"send-sms-btn",attrs:{"native-type":"button",round:"",type:"default",size:"small"},on:{click:function(e){return t.onSendSms()}}},[t._v(" 发送验证")])]},proxy:!0}]),model:{value:t.user.code,callback:function(e){t.$set(t.user,"code",e)},expression:"user.code"}}),e("div",{staticClass:"login-btn-wrap"},[e("van-button",{staticClass:"login-btn",attrs:{block:"",type:"info","native-type":"submit"}},[t._v("登录")])],1)],1)],1)},n=[],a=s(2223),i={name:"LoginView",data(){return{time:1e4,isCountDown:!1,user:{mobile:"",code:""},userFormRules:{mobile:[{required:!0,trigger:"onBlur",message:"请填写手机号"},{pattern:/^1[3|5|6|7|8|9]\d{9}$/,message:"手机号格式错误"}],code:[{required:!0,trigger:"onBlur",message:"请填写验证码"},{pattern:/^\d{6}$/,message:"验证码格式错误"}]}}},methods:{async onSubmit(){const t=this.$toast.loading({duration:0,message:"加载中...",forbidClick:!0});try{const e=this.user,s=await(0,a.x)(e);console.log(s.data.data),this.$store.commit("setUser",s.data.data),this.$toast.success("登录成功"),this.$router.back()}catch(e){400===e.response.status?(console.log("手机号或验证码错误",e),this.$toast.fail("手机号或验证码错误")):(console.log("登录失败，稍后重试",e),this.$toast.fail("登录失败，稍后重试"))}finally{t.clear()}},async onSendSms(){try{await this.$refs.loginForm.validate("mobile"),this.isCountDown=!0}catch(t){return console.log(t),void this.$toast(t.message)}try{await(0,a.e)(this.user.mobile),this.$toast.success("发送成功")}catch(t){console.log(t),console.log(t.message),this.isCountDown=!1,429===t.response.code?this.$toast.fail("短信发送太快了"):this.$toast(t.response.statusText)}}}},r=i,l=s(1001),c=(0,l.Z)(r,o,n,!1,null,"1c48ef60",null),u=c.exports}}]);
//# sourceMappingURL=678.ac06bf92.js.map