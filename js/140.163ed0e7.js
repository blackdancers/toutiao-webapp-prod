"use strict";(self["webpackChunktoutiao_webapp"]=self["webpackChunktoutiao_webapp"]||[]).push([[140],{3140:function(t,e,r){r.r(e),r.d(e,{default:function(){return D}});var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-container"},[e("form",{attrs:{action:"/"}},[e("van-search",{attrs:{placeholder:"请输入搜索关键词",background:"#3296FA","show-action":""},on:{search:t.onSearch,cancel:t.onCancel,focus:function(e){t.isResultShow=!1}},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}})],1),t.isResultShow?e("SearchResult",{attrs:{keyword:t.keyword}}):t.keyword?e("SearchSuggestion",{attrs:{keyword:t.keyword},on:{search:t.onSearch}}):e("SearchHistory",{attrs:{searchHistory:t.searchHistory},on:{search:t.onSearch,delSearchHistoryItem:t.delSearchHistoryItem,clearAllSearchHistory:function(e){t.searchHistory=[]}}})],1)},s=[],o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-suggestion"},t._l(t.suggestions,(function(r,n){return e("van-cell",{key:n,attrs:{icon:"search"},on:{click:function(e){return t.$emit("search",r)}},scopedSlots:t._u([{key:"title",fn:function(){return[e("span",{domProps:{innerHTML:t._s(t.highlight(r))}})]},proxy:!0}],null,!0)})})),1)},a=[],i=r(2745),c=r(4806),l={name:"SearchSuggestion",props:{keyword:{type:String,default:""}},watch:{keyword:{handler:(0,c.debounce)((function(t){this.loadSearchSuggestions(t)}),200),immediate:!0}},data(){return{suggestions:[]}},methods:{async loadSearchSuggestions(t){try{const{data:e}=await(0,i.hz)(t);e.data.options&&null==e.data.options[0]?this.suggestions=[this.keyword]:this.suggestions=e.data.options}catch{this.$toast("获取失败")}},highlight(t){const e=`<span class="active">${this.keyword}</span>`;return t.split(this.keyword).join(e)}}},u=l,h=r(1001),d=(0,h.Z)(u,o,a,!1,null,"0be7680c",null),f=d.exports,m=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-result"},[e("van-list",{attrs:{finished:t.finished,error:t.error,"error-text":"请求失败，点击重新加载","finished-text":"没有更多了"},on:{"update:error":function(e){t.error=e},load:t.onLoad},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},t._l(t.list,(function(t){return e("van-cell",{key:t.art_id,attrs:{title:t.title}})})),1)],1)},p=[],g={name:"SearchResult",props:{keyword:{type:String,default:""}},data(){return{error:!1,list:[],loading:!1,finished:!1,page:1,perPage:20}},methods:{async onLoad(){try{const{data:t}=await(0,i.Sx)({page:this.page,per_page:this.perPage,q:this.keyword});this.list.push(...t.data.results),this.loading=!1,t.data.results.length?this.page++:this.finished=!0}catch(t){this.error=!0,this.loading=!1,console.log(t.response.data.message)}}}},S=g,y=(0,h.Z)(S,m,p,!1,null,"62d01c9c",null),_=y.exports,v=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search-history"},[e("van-cell",{attrs:{title:"搜索历史"}},[t.isDeleteShow?[e("span",{on:{click:t.clearAllSearchHistory}},[t._v("全部删除")]),t._v("    "),e("span",{on:{click:function(e){t.isDeleteShow=!1}}},[t._v("完成")])]:e("van-icon",{attrs:{name:"delete"},on:{click:function(e){t.isDeleteShow=!0}}})],2),t._l(t.searchHistoriesClone,(function(r,n){return e("van-cell",{key:n,attrs:{title:r},on:{click:function(e){return t.onHistoryClick(r,n)}}},[t.isDeleteShow?e("van-icon",{attrs:{name:"close"}}):t._e()],1)}))],2)},k=[],w={name:"SearchHistory",props:{searchHistory:{type:Array,default:()=>[]}},data(){return{searchHistoriesClone:this.searchHistory,isDeleteShow:!1}},methods:{onHistoryClick(t,e){this.isDeleteShow?this.$emit("delSearchHistoryItem",e):this.$emit("search",t)},clearAllSearchHistory(){this.$emit("clearAllSearchHistory")}}},H=w,T=(0,h.Z)(H,v,k,!1,null,"78e3ddaa",null),E=T.exports,Z=r(7247),C={name:"SearchPage",components:{SearchSuggestion:f,SearchResult:_,SearchHistory:E},data(){return{keyword:"",isResultShow:!1,searchHistory:(0,Z.rV)("TOUTIAO_SEARCH_HISTORIES")||[]}},watch:{searchHistory(t){(0,Z.LS)("TOUTIAO_SEARCH_HISTORIES",t)}},methods:{onSearch(t){this.isResultShow=!0,this.keyword=t;const e=this.searchHistory.indexOf(t);-1!==e&&this.searchHistory.splice(e,1),this.searchHistory.unshift(t)},onCancel(){this.$toast("取消搜索"),this.$router.back()},delSearchHistoryItem(t){this.searchHistory.splice(t,1)}}},$=C,A=(0,h.Z)($,n,s,!1,null,"0c01c8a2",null),D=A.exports},2745:function(t,e,r){r.d(e,{$c:function(){return G},AD:function(){return U},_7:function(){return F},u5:function(){return R},IF:function(){return Y},gO:function(){return O},u1:function(){return L},IY:function(){return M},YE:function(){return b},nD:function(){return q},p0:function(){return x},QM:function(){return D},rk:function(){return A},VW:function(){return $},nr:function(){return z},Sx:function(){return P},hz:function(){return I},lS:function(){return C},Zf:function(){return Z},TY:function(){return V},HW:function(){return j},r0:function(){return W}});r(2223);var n=r(4471);const s=()=>(0,n.Z)({method:"GET",url:"/v1_0/user"}),o=t=>(0,n.Z)({method:"GET",url:"/v1_0/user/profile"}),a=t=>(0,n.Z)({method:"PATCH",url:"/v1_0/user/profile",data:t}),i=t=>(0,n.Z)({method:"PATCH",url:"/v1_0/user/photo",data:t}),c=t=>(0,n.Z)({method:"GET",url:"/v1_0/articles",params:t}),l=t=>(0,n.Z)({method:"GET",url:`/v1_0/articles/${t}`}),u=t=>(0,n.Z)({method:"POST",url:"/v1_0/user/followings",data:{target:t}}),h=t=>(0,n.Z)({method:"DELETE",url:`/v1_0/user/followings/${t}`}),d=t=>(0,n.Z)({method:"POST",url:"/v1_0/article/collections",data:{target:t}}),f=t=>(0,n.Z)({method:"DELETE",url:`/v1_0/article/collections/${t}`}),m=t=>(0,n.Z)({method:"POST",url:"/v1_0/article/likings",data:{target:t}}),p=t=>(0,n.Z)({method:"DELETE",url:`/v1_0/article/likings/${t}`}),g=()=>(0,n.Z)({method:"GET",url:"/v1_0/user/channels"}),S=t=>(0,n.Z)({method:"GET",url:"/v1_0/channels",params:t}),y=t=>(0,n.Z)({method:"PATCH",url:"/v1_0/user/channels",data:{channels:[t]}}),_=t=>(0,n.Z)({method:"DELETE",url:`/v1_0/user/channels/${t}`}),v=t=>(0,n.Z)({method:"GET",url:"/v1_0/suggestion",params:{q:t}}),k=t=>(0,n.Z)({method:"GET",url:"/v1_0/search",params:t}),w=t=>(0,n.Z)({method:"GET",url:"/v1_0/comments",params:t}),H=t=>(0,n.Z)({method:"POST",url:"/v1_0/comment/likings",data:{target:t}}),T=t=>(0,n.Z)({method:"DELETE",url:`/v1_0/comment/likings/${t}`}),E=t=>(0,n.Z)({method:"POST",url:"/v1_0/comments",data:t}),Z=s,C=g,$=c,A=l,D=S,O=y,x=_,I=v,P=k,R=u,b=h,G=d,L=f,Y=m,q=p,z=w,F=H,M=T,U=E,V=o,W=a,j=i}}]);
//# sourceMappingURL=140.163ed0e7.js.map