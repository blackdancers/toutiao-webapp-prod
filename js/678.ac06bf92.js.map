{"version":3,"file":"js/678.ac06bf92.js","mappings":"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","sources":["webpack://toutiao-webapp/./src/views/login/index.vue","webpack://toutiao-webapp/src/views/login/index.vue","webpack://toutiao-webapp/./src/views/login/index.vue?75e3","webpack://toutiao-webapp/./src/views/login/index.vue?a173"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"login-container\"},[_c('van-nav-bar',{staticClass:\"page-nav-bar\",attrs:{\"title\":\"登录\"},scopedSlots:_vm._u([{key:\"right\",fn:function(){return [_c('van-icon',{attrs:{\"name\":\"cross\"},on:{\"click\":function($event){return _vm.$router.back()}}})]},proxy:true}])}),_c('van-form',{ref:\"loginForm\",on:{\"submit\":_vm.onSubmit}},[_c('van-field',{attrs:{\"name\":\"mobile\",\"label\":\"手机号\",\"placeholder\":\"手机号\",\"autocomplete\":\"off\",\"rules\":_vm.userFormRules.mobile},model:{value:(_vm.user.mobile),callback:function ($$v) {_vm.$set(_vm.user, \"mobile\", $$v)},expression:\"user.mobile\"}},[_c('i',{staticClass:\"iconfont icon-shouji\",attrs:{\"slot\":\"left-icon\"},slot:\"left-icon\"})]),_c('van-field',{attrs:{\"name\":\"code\",\"label\":\"验证码\",\"placeholder\":\"验证码\",\"autocomplete\":\"off\",\"rules\":_vm.userFormRules.code},scopedSlots:_vm._u([{key:\"left-icon\",fn:function(){return [_c('i',{staticClass:\"iconfont icon-yanzhengma\"})]},proxy:true},{key:\"button\",fn:function(){return [(_vm.isCountDown)?_c('van-count-down',{attrs:{\"time\":_vm.time,\"format\":\"ss秒\"},on:{\"finish\":function($event){_vm.isCountDown = false}}}):_c('van-button',{staticClass:\"send-sms-btn\",attrs:{\"native-type\":\"button\",\"round\":\"\",\"type\":\"default\",\"size\":\"small\"},on:{\"click\":function($event){return _vm.onSendSms()}}},[_vm._v(\" 发送验证\")])]},proxy:true}]),model:{value:(_vm.user.code),callback:function ($$v) {_vm.$set(_vm.user, \"code\", $$v)},expression:\"user.code\"}}),_c('div',{staticClass:\"login-btn-wrap\"},[_c('van-button',{staticClass:\"login-btn\",attrs:{\"block\":\"\",\"type\":\"info\",\"native-type\":\"submit\"}},[_vm._v(\"登录\")])],1)],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"login-container\">\r\n    <!-- 顶部导航栏 -->\r\n    <van-nav-bar class=\"page-nav-bar\" title=\"登录\">\r\n      <!-- <van-icon slot=\"left\" name=\"cross\" @click=\"$router.back()\" /> -->\r\n      <template #right>\r\n        <van-icon name=\"cross\" @click=\"$router.back()\" />\r\n      </template>\r\n    </van-nav-bar>\r\n    <!-- 登录表单 -->\r\n    <van-form ref=\"loginForm\" @submit=\"onSubmit\">\r\n      <!-- [{ required: true, message: '请填写手机号' }] -->\r\n      <van-field v-model=\"user.mobile\" name=\"mobile\" label=\"手机号\" placeholder=\"手机号\" autocomplete=\"off\"\r\n        :rules=\"userFormRules.mobile\">\r\n        <i slot=\"left-icon\" class=\"iconfont icon-shouji\"></i>\r\n      </van-field>\r\n      <!-- [{ required: true, message: '请填写验证码' }] -->\r\n      <van-field v-model=\"user.code\" name=\"code\" label=\"验证码\" placeholder=\"验证码\" autocomplete=\"off\"\r\n        :rules=\"userFormRules.code\">\r\n        <template #left-icon>\r\n          <i class=\"iconfont icon-yanzhengma\"></i>\r\n        </template>\r\n        <template #button>\r\n          <van-count-down :time=\"time\" format=\"ss秒\" v-if=\"isCountDown\" @finish=\"isCountDown = false\" />\r\n          <!-- native-type=\"button\" 就是普通button,防止表单自动提交 -->\r\n          <van-button native-type=\"button\" round type=\"default\" size=\"small\" class=\"send-sms-btn\" @click=\"onSendSms()\"\r\n            v-else>\r\n            发送验证</van-button>\r\n        </template>\r\n      </van-field>\r\n      <div class=\"login-btn-wrap\">\r\n        <van-button class=\"login-btn\" block type=\"info\" native-type=\"submit\">登录</van-button>\r\n      </div>\r\n    </van-form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { login, getSmsCode } from '@/api/login'\r\n\r\nexport default {\r\n  name: 'LoginView',\r\n  data () {\r\n    return {\r\n      time: 10 * 1000,\r\n      isCountDown: false,\r\n      user: {\r\n        mobile: '',\r\n        code: ''\r\n      },\r\n      userFormRules: {\r\n        mobile: [{ required: true, trigger: 'onBlur', message: '请填写手机号' }, { pattern: /^1[3|5|6|7|8|9]\\d{9}$/, message: '手机号格式错误' }],\r\n        code: [{ required: true, trigger: 'onBlur', message: '请填写验证码' }, { pattern: /^\\d{6}$/, message: '验证码格式错误' }]\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    async onSubmit () {\r\n      // Toast 轻提示\r\n      const toast = this.$toast.loading({\r\n        duration: 0,\r\n        message: '加载中...',\r\n        forbidClick: true\r\n      })\r\n\r\n      try {\r\n        const user = this.user\r\n        const res = await login(user)\r\n        console.log(res.data.data)\r\n        // 登录成功之后把token放到vuex状态管理器中\r\n        this.$store.commit('setUser', res.data.data)\r\n\r\n        // 提示 success 或者 fail 的时候，会先把其它的 toast 先清除\r\n        // toast.clear()\r\n        this.$toast.success('登录成功')\r\n        // 跳转到上一个来源页面\r\n        this.$router.back()\r\n      } catch (err) {\r\n        // toast.clear()\r\n        if (err.response.status === 400) {\r\n          console.log('手机号或验证码错误', err)\r\n          this.$toast.fail('手机号或验证码错误')\r\n        } else {\r\n          console.log('登录失败，稍后重试', err)\r\n          this.$toast.fail('登录失败，稍后重试')\r\n        }\r\n      } finally {\r\n        toast.clear()\r\n      }\r\n    },\r\n    async onSendSms () {\r\n      try {\r\n        await this.$refs.loginForm.validate('mobile')\r\n        // 通过验证显示倒计时\r\n        this.isCountDown = true\r\n      } catch (error) {\r\n        console.log(error)\r\n        this.$toast(error.message)\r\n        return\r\n      }\r\n      try {\r\n        // 调用接口获取验证码\r\n        await getSmsCode(this.user.mobile)\r\n        this.$toast.success('发送成功')\r\n      } catch (error) {\r\n        console.log(error)\r\n        console.log(error.message)\r\n        // 发送失败，关闭倒计时\r\n        this.isCountDown = false\r\n        if (error.response.code === 429) {\r\n          this.$toast.fail('短信发送太快了')\r\n        } else this.$toast(error.response.statusText)\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.login-container {\r\n  .page-nav-bar {\r\n    .van-icon {\r\n      color: #fff;\r\n    }\r\n  }\r\n\r\n  .iconfont {\r\n    font-size: 32px;\r\n  }\r\n\r\n  .send-sms-btn {\r\n    background-color: #ededed;\r\n    width: 184px;\r\n    line-height: 46px;\r\n    // font-size: 16px;\r\n    color: #666;\r\n  }\r\n\r\n  .login-btn-wrap {\r\n    padding: 53px 33px;\r\n\r\n    .login-btn {\r\n      background: #6db4fb;\r\n      border: none;\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=1c48ef60&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=1c48ef60&prod&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"1c48ef60\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","attrs","scopedSlots","_u","key","fn","on","$event","$router","back","proxy","ref","onSubmit","userFormRules","mobile","model","value","user","callback","$$v","$set","expression","slot","code","isCountDown","time","onSendSms","_v","staticRenderFns","name","data","required","trigger","message","pattern","methods","duration","forbidClick","console","toast","component"],"sourceRoot":""}